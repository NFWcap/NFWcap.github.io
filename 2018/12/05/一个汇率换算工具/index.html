<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>一个汇率换算工具 | 帽子不太白</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="帽子不太白">
    <meta name="author" content="Alex">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="帽子不太白" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link">AAA</a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link">BBB</a></li>
                    
                </ul>
            </li>
            
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="http://pwnable.kr/play.php" class="animsition-link">Pwnable.kr</a></li>
                    
                    <li><a href="http://domain.com/" class="animsition-link">Name</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">帽子不太白</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2018-12-05T13:29:30.000Z" itemprop="datePublished">
          2018-12-05
      </time>
    
    
    | 
    <a href='/tags/Python/'>Python</a>
    
    
</span>
                <h1>一个汇率换算工具</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>自己用python写的一个汇率小工具</p>
<a id="more"></a>
<h1 id="汇率转换器"><a href="#汇率转换器" class="headerlink" title="汇率转换器"></a>汇率转换器</h1><p>​    学习Python的过程中想使用Python写一些小的工具来练习，这次写了一个汇率转换器。</p>
<h2 id="界面"><a href="#界面" class="headerlink" title="界面"></a>界面</h2><p><img src="/2018/12/05/一个汇率换算工具/1.png" alt="1"></p>
<p>通过下拉列表选择基准货币，以及想要兑换的目的货币，使用<code>Demand</code>按钮查询汇率，在<code>Number of Money</code> 处输入想要兑换的货币数量，<code>Exchange</code>按钮进行转换，<code>push</code>将数据存入数据库，<code>Quit</code>进行退出。</p>
<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>​    最初写了一个简单的换算脚本，后来通过API接口的方式在线查询实时汇率，然后加入GUI界面进行包装，最后实现将查询的数据存入数据库</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>​    介绍一些实现过程的细节以及遇到的问题。</p>
<h3 id="实时汇率查询"><a href="#实时汇率查询" class="headerlink" title="实时汇率查询"></a>实时汇率查询</h3><p>​    通过已经定制好的API接口直接进行查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">def request1(appkey, num1, m=&quot;GET&quot;):</span><br><span class="line">    url = &quot;http://web.juhe.cn:8080/finance/exchange/rmbquot&quot;</span><br><span class="line">    params = &#123;</span><br><span class="line">        &quot;key&quot;: appkey,  # APP Key</span><br><span class="line">        &quot;type&quot;: &quot;&quot;,  # 两种格式(0或者1,默认为0)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = urlencode(params)</span><br><span class="line">    if m == &quot;GET&quot;:</span><br><span class="line">        f = urllib.request.urlopen(&quot;%s?%s&quot; % (url, params))</span><br><span class="line">    else:</span><br><span class="line">        f = urllib.request.urlopen(url, params)</span><br><span class="line"></span><br><span class="line">    content = f.read()</span><br><span class="line">    res = json.loads(content)</span><br><span class="line">    if res:</span><br><span class="line">        error_code = res[&quot;error_code&quot;]</span><br><span class="line">        if error_code == 0:</span><br><span class="line">            # 成功请求</span><br><span class="line">            # %s %f %d</span><br><span class="line">            #print(&quot;%s的汇率为：%f&quot; % (res[&quot;result&quot;][0][&apos;data&apos; + num1][&apos;name&apos;], float(res[&quot;result&quot;][0][&apos;data&apos; + num1][&apos;fBuyPri&apos;]) * 0.01))</span><br><span class="line">            return float(res[&quot;result&quot;][0][&apos;data&apos; + num1][&apos;fBuyPri&apos;]) * 0.01, res[&quot;result&quot;][0][&apos;data&apos; + num1][&apos;name&apos;]</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;%s:%s&quot; % (res[&quot;error_code&quot;], res[&quot;reason&quot;]))</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;request api error&quot;)</span><br></pre></td></tr></table></figure>
<p>​    其中<code>appkey</code>参数是我们在网站上申请的<code>key</code>，查询的函数主要用了<code>urllib</code>库中的一些知识，<code>urllib.request.urlopen()</code>函数用于实现对目标url的访问。</p>
<p><a href="https://www.cnblogs.com/zyq-blog/p/5606760.html" target="_blank" rel="noopener">urlopen()</a>函数原型如下：</p>
<p><code>urllib.request.urlopen(url, data=None, [timeout, ]*,cafile=None,capath=None,cadefault=False,context=None)</code></p>
<p>​    利用<a href="https://www.cnblogs.com/xiaomingzaixian/p/7286793.html" target="_blank" rel="noopener">json.loads</a>函数，将字符串转化为字典，这里需要注意的是读取json的数据时，因为后面的数组中不同的货币美元、英镑、港币等分别存放在不同的datex（data1，data2……）中，所以这里选择进行拼接[‘data’ + num1]，其中<code>num1</code>是用户选择的货币在</p>
<p><code>currency = [&quot;人民币&quot;,&quot;美元&quot;,&quot;欧元&quot;,&quot;港币&quot;,&quot;日元&quot;,&quot;英镑&quot;,&quot;澳大利亚元&quot;]</code>字典中的位置</p>
<h3 id="GUI界面"><a href="#GUI界面" class="headerlink" title="GUI界面"></a>GUI界面</h3><p>​    使用<code>tkinter</code>库进行了简单的GUI搭建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">def makeform(root,fields):</span><br><span class="line">    entries =&#123;&#125;</span><br><span class="line">    entries1 =&#123;&#125;</span><br><span class="line">    for field in fields:</span><br><span class="line">        row = Frame(root)   #Frame就是屏幕上的一块矩形区域，多是用来作为容器（container）来布局窗体。</span><br><span class="line">        #文本或图像在背景内容区的位置：anchor</span><br><span class="line">        # 可选值为（n,s,w,e,ne,nw,sw,se,center）</span><br><span class="line">        # eswn是东南西北英文的首字母，表示：上北下南左西右东</span><br><span class="line">        lab = Label(row,width = 22,text = field + &quot;:&quot;,anchor = &apos;w&apos;)</span><br><span class="line">        com = ttk.Combobox(row, state=&apos;readonly&apos;)</span><br><span class="line">        com[&apos;values&apos;] = (currency)</span><br><span class="line">        com.current(0) #添加默认值为0</span><br><span class="line">        row.pack(side = TOP,fill = X,padx = 5,pady =5)</span><br><span class="line">        lab.pack(side = LEFT)</span><br><span class="line">        com.pack(side = RIGHT,expand = YES,fill =X)</span><br><span class="line">        entries[field] = com</span><br><span class="line"></span><br><span class="line">    for field1 in fields1:</span><br><span class="line">        row1 =Frame(root)</span><br><span class="line">        lab = Label(row1, width=22, text=field1 + &quot;: &quot;, anchor=&apos;w&apos;)</span><br><span class="line">        ent = Entry(row1)</span><br><span class="line">        ent.insert(0, &quot;0&quot;)</span><br><span class="line">        row1.pack(side = TOP,fill = X,padx = 5,pady =5)</span><br><span class="line">        lab.pack(side=LEFT)</span><br><span class="line">        ent.pack(side=RIGHT, expand=YES, fill=X)</span><br><span class="line">        entries1[field1] = ent</span><br><span class="line"></span><br><span class="line">    return  entries,entries1</span><br></pre></td></tr></table></figure>
<p>​    第一个for循环用于创建基准货币和交换货币的显示窗口和下拉列表，第二个for循环用于创建货币数量、汇率、交换结果、存入数据库结果的显示窗口和输入框。因为想在基准货币和交换货币内实现下拉列表的形式，所以分成了两个for循环</p>
<p>​    <code>entries[field] = com</code> <code>entries1[field1] = ent</code>分别存入两个字典，并返回可以在后面方便调用。</p>
<h3 id="查询，转换"><a href="#查询，转换" class="headerlink" title="查询，转换"></a>查询，转换</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def exchange(entries1): #转换</span><br><span class="line">    num = float(entries1[&apos;Number of Money&apos;].get())</span><br><span class="line">    rate = float(entries1[&apos;Rate&apos;].get())</span><br><span class="line">    result = num * rate</span><br><span class="line">    entries1[&apos;Result&apos;].delete(0, END)</span><br><span class="line">    entries1[&apos;Result&apos;].insert(0,result)</span><br><span class="line"></span><br><span class="line">def demand(entries,entries1): #查询</span><br><span class="line">    str1 = currency.index(entries[&apos;Basic Money&apos;].get())</span><br><span class="line">    str2 = currency.index(entries[&apos;Exchange Money&apos;].get())</span><br><span class="line">    if (int(str1) != 0):</span><br><span class="line">        basic_price, basic_name = request1(appkey, str(str1), &quot;GET&quot;)</span><br><span class="line">    else:</span><br><span class="line">        basic_price, basic_name = 1, &quot;人民币&quot;</span><br><span class="line">    if (int(str2) != 0):</span><br><span class="line">        exchange_price, exchange_name = request1(appkey, str(str2), &quot;GET&quot;)</span><br><span class="line">    else:</span><br><span class="line">        exchange_price, exchange_name = 1, &quot;人民币&quot;</span><br><span class="line">    rate = basic_price/exchange_price</span><br><span class="line">    entries1[&apos;Rate&apos;].delete(&apos;0&apos;,END)</span><br><span class="line">    entries1[&apos;Rate&apos;].insert(&apos;0&apos;,round(rate,4))`</span><br></pre></td></tr></table></figure>
<p>​    查询和转换功能需要强调的就是提取下拉列表和输入框内容的部分，我们在生成GUI时，将下拉列表和输入框都存入了字典，这样在使用其数据时，只需要使用</p>
<blockquote>
<p>entries[‘Basic Money’].get()</p>
</blockquote>
<p>这样的方法</p>
<p>同样想将生成的数据填入空白框内</p>
<blockquote>
<p>entries1[‘Rate’].delete(‘0’,END) entries1[‘Rate’].insert(‘0’,round(rate,4))</p>
</blockquote>
<h3 id="数据库模块"><a href="#数据库模块" class="headerlink" title="数据库模块"></a>数据库模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def put_mysql(entries,entries1):</span><br><span class="line">    db = pymysql.connect(&quot;localhost&quot;,&quot;root&quot;,&quot;123456&quot;,&quot;exchange_money&quot;,charset=&quot;utf8&quot;)</span><br><span class="line">    cursor = db.cursor()</span><br><span class="line">    sql = &quot;INSERT INTO EMPLOYEE(BASIC_MONEY,EXCHANGE_MONEY,ECHANGE_RATE,NUMBER) values (%s,%s,%s,%s)&quot;</span><br><span class="line">    try:</span><br><span class="line">        cursor.execute(sql,[entries[&apos;Basic Money&apos;].get(),entries[&apos;Exchange Money&apos;].get(),</span><br><span class="line">                            entries1[&apos;Rate&apos;].get(),entries1[&apos;Number of Money&apos;].get()])</span><br><span class="line">        db.commit()</span><br><span class="line">        entries1[&apos;Database&apos;].delete(0,END)</span><br><span class="line">        entries1[&apos;Database&apos;].insert(0,&apos;数据已入库&apos;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;error:%s&quot; %e)</span><br><span class="line">        db.rollback()</span><br><span class="line">        print(&quot;存入失败&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">from urllib.parse import urlencode</span><br><span class="line"></span><br><span class="line">fields =(&apos;Basic Money&apos;,&apos;Exchange Money&apos;)</span><br><span class="line">fields1  = (&apos;Number of Money&apos;,&apos;Rate&apos;,&apos;Result&apos;,&apos;Database&apos;)</span><br><span class="line">currency = [&quot;人民币&quot;,&quot;美元&quot;,&quot;欧元&quot;,&quot;港币&quot;,&quot;日元&quot;,&quot;英镑&quot;,&quot;澳大利亚元&quot;]</span><br><span class="line">appkey = &quot;cbea01f970765eabe53f4eb73422fdf8&quot;</span><br><span class="line"></span><br><span class="line">def put_mysql(entries,entries1):</span><br><span class="line">    db = pymysql.connect(&quot;localhost&quot;,&quot;root&quot;,&quot;123456&quot;,&quot;exchange_money&quot;,charset=&quot;utf8&quot;)</span><br><span class="line">    cursor = db.cursor()</span><br><span class="line">    sql = &quot;INSERT INTO EMPLOYEE(BASIC_MONEY,EXCHANGE_MONEY,ECHANGE_RATE,NUMBER) values (%s,%s,%s,%s)&quot;</span><br><span class="line">    try:</span><br><span class="line">        cursor.execute(sql,[entries[&apos;Basic Money&apos;].get(),entries[&apos;Exchange Money&apos;].get(),</span><br><span class="line">                            entries1[&apos;Rate&apos;].get(),entries1[&apos;Number of Money&apos;].get()])</span><br><span class="line">        db.commit()</span><br><span class="line">        entries1[&apos;Database&apos;].delete(0,END)</span><br><span class="line">        entries1[&apos;Database&apos;].insert(0,&apos;数据已入库&apos;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;error:%s&quot; %e)</span><br><span class="line">        db.rollback()</span><br><span class="line">        print(&quot;存入失败&quot;)</span><br><span class="line"></span><br><span class="line">    db.close()</span><br><span class="line">def exchange(entries1): #转换</span><br><span class="line">    num = float(entries1[&apos;Number of Money&apos;].get())</span><br><span class="line">    rate = float(entries1[&apos;Rate&apos;].get())</span><br><span class="line">    result = num * rate</span><br><span class="line">    entries1[&apos;Result&apos;].delete(0, END)</span><br><span class="line">    entries1[&apos;Result&apos;].insert(0,result)</span><br><span class="line"></span><br><span class="line">def demand(entries,entries1): #查询</span><br><span class="line">    str1 = currency.index(entries[&apos;Basic Money&apos;].get())</span><br><span class="line">    str2 = currency.index(entries[&apos;Exchange Money&apos;].get())</span><br><span class="line">    if (int(str1) != 0):</span><br><span class="line">        basic_price, basic_name = request1(appkey, str(str1), &quot;GET&quot;)</span><br><span class="line">    else:</span><br><span class="line">        basic_price, basic_name = 1, &quot;人民币&quot;</span><br><span class="line">    if (int(str2) != 0):</span><br><span class="line">        exchange_price, exchange_name = request1(appkey, str(str2), &quot;GET&quot;)</span><br><span class="line">    else:</span><br><span class="line">        exchange_price, exchange_name = 1, &quot;人民币&quot;</span><br><span class="line">    rate = basic_price/exchange_price</span><br><span class="line">    entries1[&apos;Rate&apos;].delete(&apos;0&apos;,END)</span><br><span class="line">    entries1[&apos;Rate&apos;].insert(&apos;0&apos;,round(rate,4))</span><br><span class="line"></span><br><span class="line">def request1(appkey, num1, m=&quot;GET&quot;):</span><br><span class="line">    url = &quot;http://web.juhe.cn:8080/finance/exchange/rmbquot&quot;</span><br><span class="line">    params = &#123;</span><br><span class="line">        &quot;key&quot;: appkey,  # APP Key</span><br><span class="line">        &quot;type&quot;: &quot;&quot;,  # 两种格式(0或者1,默认为0)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    params = urlencode(params)</span><br><span class="line">    if m == &quot;GET&quot;:</span><br><span class="line">        f = urllib.request.urlopen(&quot;%s?%s&quot; % (url, params))</span><br><span class="line">    else:</span><br><span class="line">        f = urllib.request.urlopen(url, params)</span><br><span class="line"></span><br><span class="line">    content = f.read()</span><br><span class="line">    res = json.loads(content)</span><br><span class="line">    if res:</span><br><span class="line">        error_code = res[&quot;error_code&quot;]</span><br><span class="line">        if error_code == 0:</span><br><span class="line">            # 成功请求</span><br><span class="line">            # %s %f %d</span><br><span class="line">            #print(&quot;%s的汇率为：%f&quot; % (res[&quot;result&quot;][0][&apos;data&apos; + num1][&apos;name&apos;], float(res[&quot;result&quot;][0][&apos;data&apos; + num1][&apos;fBuyPri&apos;]) * 0.01))</span><br><span class="line">            return float(res[&quot;result&quot;][0][&apos;data&apos; + num1][&apos;fBuyPri&apos;]) * 0.01, res[&quot;result&quot;][0][&apos;data&apos; + num1][&apos;name&apos;]</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;%s:%s&quot; % (res[&quot;error_code&quot;], res[&quot;reason&quot;]))</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;request api error&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def makeform(root,fields):</span><br><span class="line">    entries =&#123;&#125;</span><br><span class="line">    entries1 =&#123;&#125;</span><br><span class="line">    for field in fields:</span><br><span class="line">        row = Frame(root)   #Frame就是屏幕上的一块矩形区域，多是用来作为容器（container）来布局窗体。</span><br><span class="line">        #文本或图像在背景内容区的位置：anchor</span><br><span class="line">        # 可选值为（n,s,w,e,ne,nw,sw,se,center）</span><br><span class="line">        # eswn是东南西北英文的首字母，表示：上北下南左西右东</span><br><span class="line">        lab = Label(row,width = 22,text = field + &quot;:&quot;,anchor = &apos;w&apos;)</span><br><span class="line">        com = ttk.Combobox(row, state=&apos;readonly&apos;)</span><br><span class="line">        com[&apos;values&apos;] = (currency)</span><br><span class="line">        com.current(0) #添加默认值为0</span><br><span class="line">        row.pack(side = TOP,fill = X,padx = 5,pady =5)</span><br><span class="line">        lab.pack(side = LEFT)</span><br><span class="line">        com.pack(side = RIGHT,expand = YES,fill =X)</span><br><span class="line">        entries[field] = com</span><br><span class="line"></span><br><span class="line">    for field1 in fields1:</span><br><span class="line">        row1 =Frame(root)</span><br><span class="line">        lab = Label(row1, width=22, text=field1 + &quot;: &quot;, anchor=&apos;w&apos;)</span><br><span class="line">        ent = Entry(row1)</span><br><span class="line">        ent.insert(0, &quot;0&quot;)</span><br><span class="line">        row1.pack(side = TOP,fill = X,padx = 5,pady =5)</span><br><span class="line">        lab.pack(side=LEFT)</span><br><span class="line">        ent.pack(side=RIGHT, expand=YES, fill=X)</span><br><span class="line">        entries1[field1] = ent</span><br><span class="line"></span><br><span class="line">    return  entries,entries1</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    root = Tk()</span><br><span class="line">    root.title(&apos;汇率转换器&apos;)</span><br><span class="line">    ents,ents1 = makeform(root,fields)</span><br><span class="line">    b1 = Button(root,text = &apos;Demand&apos;,</span><br><span class="line">                command = (lambda e =ents,e1=ents1:demand(e,e1)))</span><br><span class="line">    b1.pack(side = LEFT,padx = 5,pady =5)</span><br><span class="line">    b2 = Button(root, text=&apos;Exchange&apos;,</span><br><span class="line">                command=(lambda e=ents1: exchange(e)))</span><br><span class="line">    b2.pack(side=LEFT, padx=5, pady=5)</span><br><span class="line">    b3 = Button(root,text = &apos;Push into Datebases&apos;,</span><br><span class="line">                command = (lambda e =ents,e1=ents1:put_mysql(e,e1)))</span><br><span class="line">    b3.pack(side = LEFT,padx =5,pady =5)</span><br><span class="line">    b4 = Button(root,text = &apos;Quit&apos;,command = root.quit)</span><br><span class="line">    b4.pack(side = LEFT,padx = 5,pady = 5)</span><br><span class="line">    root.mainloop()</span><br></pre></td></tr></table></figure>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    
    <a class="pull-right" href="/2018/11/23/Python装饰器/">
        Python装饰器 →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Alex. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
